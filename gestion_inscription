CREATE TABLE "TB_ETUDIANTS" (
    "ID_ETUDIANT" SERIAL PRIMARY KEY,
    "NOM" VARCHAR(255),
    "PRENOM" VARCHAR(255),
    "DT_DE_NAISSANCE" DATE,
    "ADRESSE_EMAIL" VARCHAR(255) UNIQUE,
    "NUMERO_DE_TELEPHONE" VARCHAR(20)
);

--DROP TABLE IF EXISTS "TB_INSCRIPTION" CASCADE;

CREATE TABLE "TB_INSCRIPTION" 
(
"ID_INSCRIPTION" 			SERIAL PRIMARY KEY,
"DT_INSCRIPTION" 			TIMESTAMP NOT NULL,
"LB_TYPE_PAIEMENT_SOUHAITE"	VARCHAR(100) NOT NULL,
"ID_ETUDIANT" 				SERIAL NOT NULL,	
"ANNEE_SCOLAIRE"			NUMERIC NOT NULL,
UNIQUE ("ID_ETUDIANT", "ANNEE_SCOLAIRE"),

CONSTRAINT "TB_INSCRIPTION_ETUDIANT_FKEY" FOREIGN KEY("ID_ETUDIANT") 
	REFERENCES "TB_ETUDIANTS"("ID_ETUDIANT"),

CONSTRAINT "CHECK_TYPE_PAIEMENT" CHECK ("LB_TYPE_PAIEMENT_SOUHAITE" IN ('Unique', 'Echéancier'))	
);

CREATE TABLE "TB_DOCUMENT" (
    "ID_DOCUMENT" SERIAL PRIMARY KEY,
    "ID_ETUDIANT" SERIAL NOT NULL,
    "NOM_DOCUMENT" VARCHAR(255) NOT NULL,
    "TYPE_DOCUMENT" VARCHAR(50) NOT NULL,
    "CONTENU" BYTEA NOT NULL,
    "DATE_UPLOAD" TIMESTAMP NOT NULL,

	CONSTRAINT "TB_DOCUMENT_ETUDIANT_FKEY" FOREIGN KEY("ID_ETUDIANT") 
		REFERENCES "TB_ETUDIANTS"("ID_ETUDIANT")
);

-- Script de création de la table										
-- DROP TABLE IF EXISTS "TB_PAIEMENT" CASCADE;		
CREATE TABLE "TB_PAIEMENT" 
(
"ID_PAIEMENT" 		SERIAL NOT NULL,
"DT_PAIEMENT" 		TIMESTAMP NOT NULL,
"MONTANT_PAYE"			NUMERIC NOT NULL,
"PREUVE_PAIEMENT" 	BYTEA NOT NULL,
"ID_PAYEUR" 		SERIAL NOT NULL,
"ID_INSCRIPTION" 	SERIAL NOT NULL,	

CONSTRAINT "TB_PAIEMENT_PKEY" PRIMARY KEY("ID_PAIEMENT"),

CONSTRAINT "TB_PAIEMENT_PAYEUR_FKEY" FOREIGN KEY("ID_PAYEUR") 
	REFERENCES "TB_PAYEUR"("ID_PAYEUR"),

CONSTRAINT "TB_PAIEMENT_INSCRIPTION_FKEY" FOREIGN KEY("ID_INSCRIPTION") 
	REFERENCES "TB_INSCRIPTION"("ID_INSCRIPTION")	
);

CREATE TABLE "TB_PAYEUR" 
(
"ID_PAYEUR" 		SERIAL  NOT NULL,
"CD_CNI_PAYEUR" 	VARCHAR(100) NOT NULL,
"LB_NOM_PAYEUR" 	VARCHAR(100) NOT NULL,
"LB_PREN_PAYEUR" 	VARCHAR(100) NOT NULL,
"LB_ADR_PAYEUR" 	VARCHAR(100) NOT NULL,
"LB_TEL_PAYEUR" 	VARCHAR(100) NOT NULL,
UNIQUE ("CD_CNI_PAYEUR"),
CONSTRAINT "TB_PAYEUR_PKEY" PRIMARY KEY("ID_PAYEUR")
);

-- DROP TABLE IF EXISTS "TB_ECHEANCE" ;
CREATE TABLE "TB_ECHEANCE" 
(
"ID_ECHEANCE" 		SERIAL NOT NULL,
"DT_ECHEANCE" 		TIMESTAMP NOT NULL,
"MT_ECHEANCE"		NUMERIC NOT NULL,
"PREUVE_PAIEMENT" 	BYTEA NOT NULL,
"ID_INSCRIPTION" 	SERIAL NOT NULL,	
"ID_PAIEMENT" 		SERIAL NOT NULL,
CONSTRAINT "TB_ECHEANCE_PKEY" PRIMARY KEY("ID_ECHEANCE"),

CONSTRAINT "TB_ECHEANCE_INSCRIPTION_FKEY" FOREIGN KEY("ID_INSCRIPTION") 
	REFERENCES "TB_INSCRIPTION"("ID_INSCRIPTION"),

CONSTRAINT "TB_ECHEANCE_PAIEMENT_FKEY" FOREIGN KEY("ID_PAIEMENT") 
	REFERENCES "TB_PAIEMENT"("ID_PAIEMENT")
);


CREATE TABLE "TB_TESTS" (
    "ID_TEST" SERIAL PRIMARY KEY,
    "ID_ETUDIANT" SERIAL NOT NULL,
    "DT_DU_TEST" TIMESTAMP NOT NULL,
    "SCORE" VARCHAR(20),
    "STATUT_DU_TEST" VARCHAR(255),
    CONSTRAINT "TB_TESTS_ETUDIANT_FKEY" FOREIGN KEY("ID_ETUDIANT") 
	REFERENCES "TB_ETUDIANTS"("ID_ETUDIANT")
);


--DROP TABLE IF EXISTS "tb_admissions" CASCADE;

CREATE TABLE "TB_ADMISSIONS" (
    "ID_ADMISSION" SERIAL PRIMARY KEY,
    "ID_ETUDIANT" SERIAL NOT NULL,
    "RESULTAT_FINAL" VARCHAR(255),
    "DT_DE_DECISION" TIMESTAMP NOT NULL,
    CONSTRAINT "TB_ADMISSIONS_ETUDIANT_FKEY" FOREIGN KEY("ID_ETUDIANT") 
	REFERENCES "TB_ETUDIANTS"("ID_ETUDIANT")
);


